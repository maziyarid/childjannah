# Cursor AI Rules â€” Teznevisan Child Theme
# This file is read by Cursor IDE's AI assistant.
# Apply ALL rules below when generating, editing, or reviewing code.

## Project Context

This is the **Teznevisan** WordPress child theme for the **Jannah** parent theme.
- Language: Persian (Farsi), RTL layout, `fa_IR` locale
- Audience: Iranian mobile users
- Parent prefix: `tie-` (Jannah â€” DO NOT conflict)
- Child prefix: `tez-` (ALL CSS classes, JS IDs)
- PHP prefix: `tez_` (ALL functions, hooks, constants)
- Current version: 3.2.0

## ğŸ”” MANDATORY: Tag @coderabbitai

In every code review, PR comment, or analysis response:
ALWAYS end the message with:

```
---
> ğŸ¤– @coderabbitai â€” Please review the above and verify.
```

## File Map

- `header.php` â€” Mobile menu, search overlay, theme/a11y widgets, skip link
- `footer.php` â€” Footer with schema markup
- `css/main.css` â€” ENTIRE design system (tokens, themes, components)
- `js/scripts.js` â€” ALL modules: theme, a11y toolbar, mobile menu, search, etc.
- `js/single-post.js` â€” Single post features: ToC, sharing
- `functions.php` â€” Bootstrapper: loads all `inc/` files
- `inc/core-setup.php` â€” Theme support, enqueue scripts
- `inc/key-takeaways.php` â€” Key Takeaways (posts only, NOT pages)
- `inc/toc.php` â€” Table of Contents
- `inc/faq-schema.php` â€” FAQ accordion + FAQPage schema
- `inc/star-rating.php` â€” AJAX star rating
- `inc/polls.php` â€” AJAX polls
- `inc/seo-redirects.php` â€” SEO redirects
- `inc/typography.php` â€” Persian typography
- `inc/icon-mapping.php` â€” Icon name to FA class mapping
- `template-dynamic-content.php` â€” Custom page template

## CSS Rules

### 1. Design Tokens
All values use CSS custom properties. Token names: `--tez-[property]`.
Tokens defined in `:root` in `css/main.css`.
```css
color: var(--tez-primary);
font-family: var(--tez-font);
z-index: var(--tez-z-modal);
```

### 2. ALWAYS Mobile-First
```css
/* âœ… */
.component { /* mobile base */ }
@media (min-width: 576px) { /* tablet+ */ }
@media (min-width: 1024px) { /* desktop+ */ }

/* âŒ NEVER */
@media (max-width: 1023px) { }
```

### 3. ALWAYS GPU Animations
```css
/* âœ… */
transform: translateX(100%);
transition: transform 350ms ease;

/* âŒ */
right: -100%;
transition: right 350ms;
```

### 4. Font Awesome Scoping
```html
<!-- âœ… -->
<i class="tez-icon fa-solid fa-home" aria-hidden="true"></i>

<!-- âŒ -->
<i class="fa-solid fa-home"></i>
```

### 5. RTL Support Required
```css
/* Always add RTL variant */
[dir="rtl"] .component {
    transform: translateX(-100%);
}
```

### 6. Three Themes
```css
:root              { /* light */ }
[data-theme="dark"]  { /* dark  */ }
[data-theme="sepia"] { /* sepia */ }
```

## PHP Rules

### Always Escape Output
```php
echo esc_html($text);
echo esc_url($url);
echo esc_attr($attr);
echo wp_kses_post($html);
```

### Always Guard Files
```php
<?php
if (!defined('ABSPATH')) exit;
```

### Function Prefix
```php
function tez_my_function() {}
add_action('wp_enqueue_scripts', 'tez_enqueue_assets');
```

### Key Takeaways: Posts Only
```php
// ONLY on single posts
if (!is_single() || !is_singular('post')) {
    return $content;
}
// Also check:
if (!in_the_loop() || !is_main_query()) {
    return $content;
}
```

### AJAX Security
```php
check_ajax_referer('tez_nonce', 'nonce');
current_user_can('capability');
sanitize_text_field($_POST['value']);
```

## JavaScript Rules

### IIFE Module Pattern
```javascript
(function() {
    'use strict';
    const $ = (sel, ctx = document) => ctx.querySelector(sel);
    const $$ = (sel, ctx = document) => [...ctx.querySelectorAll(sel)];
    
    function init() { /* ... */ }
    
    document.readyState === 'loading'
        ? document.addEventListener('DOMContentLoaded', init)
        : init();
})();
```

### No jQuery â€” Vanilla JS Only

### Debounce Scroll/Resize
```javascript
window.addEventListener('scroll', debounce(handler, 100));
```

### RTL Detection
```javascript
const isRTL = (tez.isRTL === 'true') || (document.documentElement.dir === 'rtl');
```

### Screen Reader Announcements
```javascript
announceToScreenReader('Ù…Ù†ÙˆÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø¨Ø§Ø² Ø´Ø¯');
```

## Accessibility Rules (WCAG 2.1 AA)

- All modals: `role="dialog"` + `aria-label` + focus trap
- All buttons: `aria-label` OR visible text
- Expanded toggles: `aria-expanded` + `aria-controls`
- Decorative icons: `aria-hidden="true"`
- Touch targets: minimum 44x44px
- Skip link: `<a href="#tez-main-content">`
- All ARIA state changes: announce to screen reader

## Z-Index Reference
```
--tez-z-dropdown: 1000
--tez-z-sticky:   1020
--tez-z-fixed:    1030  â† floating widgets
--tez-z-overlay:  1040  â† menu overlay backdrop
--tez-z-modal:    1050  â† mobile menu panel
--tez-z-tooltip:  1070
```

## Key IDs
```
#tez-site-header      â† main header
#tez-mobile-menu      â† slide-in menu panel
#tez-mobile-toggle    â† hamburger button
#tez-mobile-overlay   â† backdrop
#tez-mobile-close     â† close button inside menu
#tez-search-overlay   â† fullscreen search
#tez-search-toggle    â† search button
#tez-main-content     â† skip link target
#tez-scroll-top       â† scroll-to-top button
#tez-chaty            â† floating contact widget
```

## State Classes
```
.is-open     â† menu/overlay open
.is-visible  â† overlay visible
.is-active   â† toggle active state
.is-scrolled â† header after scroll
.is-hidden   â† header hidden on scroll
.is-expanded â† submenu expanded
tez-loaded   â† body class after JS init
tez-menu-open â† body class when menu open
```
