# Comprehensive Technical Audit & Redevelopment Roadmap for Jannah News Child Theme

## Executive Summary

Your website, `teznevisan3.com`, has undergone significant emergency cleanup over the past weeks: spam injection removed, `.htaccess` secured, `robots.txt` optimized, a disavow file uploaded, Wordfence installed, and two‑factor authentication enabled. These actions have eliminated the immediate threats and started the process of recovering your site’s reputation with search engines.  

However, the underlying **theme layer** remains a critical bottleneck. The site runs on the **Jannah News** theme, but nearly all its functionality has been overridden by **2,500+ lines of custom PHP/CSS/JS** injected via the **WP Code** plugin. This has resulted in:

- **Performance disaster** – inline CSS/JS, duplicate Font Awesome, render‑blocking resources, and heavy service‑page templates that bypass the theme entirely.
- **SEO conflicts** – duplicate H1s, overlapping schemas, broken page layouts, and poor mobile responsiveness.
- **UI/UX breakage** – custom `.tez-*` classes overriding Jannah’s responsive grid, missing dark/sepia mode support, and broken theme features (breadcrumbs, back‑to‑top, etc.).
- **Maintainability nightmare** – all logic lives in WP Code snippets, making updates impossible and debugging a nightmare.

The good news is that **80% of your custom code can be replaced by Jannah’s built‑in features** – shortcodes, Page Builder, Custom Content Blocks, and theme options. The remaining 20% (advanced Table of Contents, poll system, visual sitemap, tag hub, 404 hub, and your service‑page CSS) are valuable and should be migrated into the official **Jannah Child Theme**, where they will be safe, version‑controlled, and maintainable.

This report provides a **complete, step‑by‑step roadmap** to transform your site from its current fragile state into an **ultra‑lightweight, 100/100 PageSpeed, perfect Core Web Vitals, error‑free, and fully functional service‑provider website** – all within the Jannah ecosystem.

---

## Current Status (As of February 2026)

### ✅ Already Completed (from your Excel & chat history)

- **Spam injection** – URLs with `?e=`, `shop.php`, `jp.php`, etc., return **410 Gone**; `.htaccess` blocks them at server level.
- **Robots.txt** – fully updated, allows all major AI crawlers (GPTBot, ClaudeBot, PerplexityBot, Google‑Extended, etc.), blocks spam patterns.
- **Disavow file** – 137 toxic domains disavowed, protecting your site from negative SEO.
- **Security** – Wordfence active, 2FA enabled, all admin passwords changed, Cloudflare integrated.
- **GSC removals** – 30+ spam‑parameter patterns temporarily removed.
- **Feeds** – rewritten WP Code snippet now returns **410 Gone** for `/feed/comments` and `/feed/products` while keeping the main RSS feed (good for subscribers).
- **Author archives** – disabled via snippet (no change needed).
- **llms.txt** – validated and uploaded, making your site AI‑friendly.

### ❌ Still Open (The Theme Layer Crisis)

Despite the above, the **site’s front‑end and user experience** are severely broken because the theme has been gutted by custom overrides. Here are the major problems that remain:

#### 1. Performance Killers (PageSpeed <70, failing CWV)

- **Inline `<style>` and `<script>`** injected at `priority 9999` from WP Code snippets (Typography, Single Post CSS/JS, Service Page, Star Rating, Remove Titles, Critical CSS). These are render‑blocking and cannot be cached.
- **Duplicated Font Awesome** – local FA7 in Typography + CDN in Star Rating snippet.
- **Service Page Template** – full HTML/CSS/JS rendered inside PHP, producing **200+ KB** of inline code per page.
- **Multiple `setTimeout` and repeated `DOMContentLoaded` listeners** – custom JS is not minified or deferred.
- **No proper enqueuing** – all custom assets are printed directly in `wp_head`/`wp_footer`.

#### 2. SEO & Indexing Issues

- **Duplicate H1s** – Jannah outputs `.entry-title H1`; your “Remove Titles” snippet adds another H1 hidden with CSS (but Google still sees it).
- **Overlapping schemas** – RankMath/Yoast schemas + custom Article/AggregateRating from Star Rating snippet + service‑page schema = validation errors.
- **Service pages** disable SEO plugins and inject their own schema – often invalid.
- **Custom taxonomies** (`tez_service_*`) not included in Jannah’s sitemap.
- **Missing meta titles/descriptions** on many pages (from Moz audit).

#### 3. UI/UX & Theme Conflicts

- **Custom `.tez-*` classes** override Jannah’s responsive grid – mobile layout broken, menu collapses incorrectly.
- **Service pages** completely bypass Jannah’s template hierarchy – no header/footer consistency, no mega menu, no sticky elements.
- **Heavy `!important` and hardcoded colors** – dark mode and sepia mode (which your CSS supports) are broken because colors are hardcoded with `!important`.
- **Duplicate features** – your custom back‑to‑top, reading progress, and FAQ accordion duplicate Jannah’s built‑in toggles.
- **Custom TOC** duplicates Jannah’s `[content_index]` shortcode.
- **Custom star rating** duplicates Jannah’s review shortcode.

#### 4. Maintainability & Security

- All logic in **WP Code** – no version control, impossible to update safely.
- Service form AJAX has **basic nonce but weak rate‑limiting**; file uploads go to an open folder.
- Hardcoded emails in PHP.
- No caching headers on custom assets.

#### 5. Redundancies vs. Jannah Natives

| Custom Feature | Jannah Built‑in Alternative |
|----------------|-----------------------------|
| Table of Contents | `[content_index]` shortcode + styling |
| Star rating | `[review]` shortcode |
| Buttons, boxes, columns | Jannah shortcodes (`[button]`, `[box]`, `[columns]`) |
| Tabs, toggles, FAQ | Jannah shortcodes (`[tabs]`, `[toggle]`) |
| Page layouts | Jannah Page Builder + Custom Content Blocks |
| Reading progress | Jannah theme option (or simple CSS/JS) |

---

## Goal & Vision

- **100/100 PageSpeed** (mobile + desktop)
- **Perfect Core Web Vitals** (LCP <2.5s, CLS <0.1, FID <100ms)
- **Zero console errors**
- **No duplicate content / schemas**
- **Fully responsive** – mobile, tablet, desktop
- **All custom features** migrated into **Jannah Child Theme** using official Jannah APIs where possible
- **Maintainable** – future Jannah updates safe, code in child theme, not WP Code

---

## The Migration Plan: From WP Code to Jannah Child Theme

We will move **all** custom PHP, CSS, and JS into the official **Jannah Child Theme** (which you already have). The child theme’s `functions.php` will act as the central loader for modular files. We will keep only the features that Jannah cannot do natively:

- Advanced Table of Contents (with meta box and auto‑insert)
- Poll system (database + frontend)
- Visual sitemap page
- Tag hub page template
- 404 content hub
- Service‑page CSS system (`.tez-*` classes)
- SEO URL cleanup (already converted to child theme)
- Irancell local fonts + FA7 local

Everything else will be **removed from WP Code** and replaced by Jannah’s built‑ins.

---

## Phase 0: Preparation (1 Day)

1. **Create a full backup** of the entire site (files + database) – *already done.*
2. **Set up a staging environment** (subdomain or local copy) – **must do** before touching the live theme.
3. **Deactivate all WP Code snippets** on staging – the site will break; that’s expected.
4. **Activate the Jannah Child Theme** on staging.
5. **Install and activate** the **Jannah Extensions** plugin (provides shortcodes, page builder, etc.).
6. **Install a performance plugin** (WP Rocket or FlyingPress) – we’ll use it later for final optimizations.

---

## Phase 1: Child Theme Foundation (Day 1)

### Step 1.1 – Child Theme Structure

Your existing `jannah-child` folder should have this structure:

```
jannah-child/
├── style.css
├── functions.php
├── scripts.js (optional)
└── inc/               (new folder for all custom modules)
    ├── seo-url-cleanup.php
    ├── beautiful-toc.php
    ├── complete-poll.php
    ├── visual-sitemap.php
    ├── tag-hub.php
    ├── 404-hub.php
    ├── about-template.php
    ├── contact-template.php
    └── service-form-handler.php
```

### Step 1.2 – Update `style.css`

Ensure the header points to the parent theme:

```css
/*
Theme Name:   Jannah Child
Template:     jannah
Version:      2.0.0
*/
```

### Step 1.3 – Update `functions.php`

We’ll use it to enqueue assets and load modules. Start with a clean file:

```php
<?php
add_action( 'wp_enqueue_scripts', 'jannah_child_enqueue_styles', 20 );
function jannah_child_enqueue_styles() {
    // Load parent theme style
    wp_enqueue_style( 'parent-style', get_template_directory_uri() . '/style.css' );
    // Load child theme style (this will contain @import of your page templates CSS)
    wp_enqueue_style( 'child-style', get_stylesheet_directory_uri() . '/style.css', array('parent-style') );
    // Optional custom JS – enqueue later if needed
}

// Load all custom PHP modules
$inc_dir = get_stylesheet_directory() . '/inc/';
$modules = [
    'seo-url-cleanup.php',
    'beautiful-toc.php',
    'complete-poll.php',
    'visual-sitemap.php',
    'tag-hub.php',
    '404-hub.php',
    'about-template.php',
    'contact-template.php',
    'service-form-handler.php',
];
foreach ( $modules as $module ) {
    $file = $inc_dir . $module;
    if ( file_exists( $file ) ) {
        require_once $file;
    }
}
```

**Important:** The modules must be self‑contained (no conflicts with Jannah). We’ll adjust them later.

---

## Phase 2: Consolidate CSS & Design System (Day 2)

### Step 2.1 – Merge All Custom CSS

Your custom styles currently live in multiple snippets: `Complete-Page-Templates-CSS.css`, `Contain-Post-Elements.css`, etc. We’ll consolidate them into one file: `assets/css/tez-custom.css`.

1. Create `/jannah-child/assets/css/` folder.
2. Copy all CSS from your snippets into `tez-custom.css`.
3. Remove any duplicate rules and unused `.tez-*` classes.
4. Ensure all CSS uses **CSS variables** (already defined in your file) so dark/sepia modes work.
5. **Important:** Avoid `!important` unless absolutely necessary. Let Jannah’s styles cascade.

### Step 2.2 – Enqueue the Consolidated CSS

In `functions.php`, add:

```php
add_action( 'wp_enqueue_scripts', 'tez_enqueue_custom_css', 30 );
function tez_enqueue_custom_css() {
    wp_enqueue_style( 'tez-custom', get_stylesheet_directory_uri() . '/assets/css/tez-custom.css', array('child-style'), '2.1.0' );
}
```

### Step 2.3 – Align Jannah Theme Options with Your Variables

In WordPress admin, go to **Jannah → Theme Options → Styling Settings**:

- Set **Primary Color** to `#2563eb` (your `--tez-primary`).
- If you use dark mode, enable **Global Dark Skin** – your CSS will override variables correctly.
- Set **Typography** to your local fonts (Irancell + system stack) – disable Google Fonts.

---

## Phase 3: Replace Redundant Features with Jannah Built‑ins (Day 3-4)

We will go through each WP Code snippet and decide:

- **Keep & migrate** (if Jannah can’t do it)
- **Replace** (if Jannah has a native equivalent)

### Step 3.1 – Star Rating

Your custom rating system duplicates Jannah’s **review shortcode**.  
**Action:** Delete the Star Rating snippet from WP Code.  
**Use instead:** In any post, add the `[review]` shortcode. Configure it via the Jannah meta box.  
**If you need the IP‑based voting**, keep the poll system (see below) – but for product/service ratings, Jannah is sufficient.

### Step 3.2 – Basic Table of Contents

Jannah has `[content_index]`. It’s simple but may not have the advanced options (position, style, auto‑insert).  
**Decision:** Keep your advanced ToC module (`beautiful-toc.php`) and move it to the child theme. It’s one of the features you want to preserve.  
**Optimization:** Ensure it uses the same CSS variables and doesn’t load extra JS if not needed. Defer its JS.

### Step 3.3 – Poll System

Jannah has no built‑in poll. Keep `complete-poll.php` in child theme.  
**Optimization:** Enqueue its CSS/JS only on singular pages where a poll exists (use `wp_add_inline_script`).

### Step 3.4 – Visual Sitemap, Tag Hub, 404 Hub

These are custom page templates. Keep them in child theme.  
**Optimization:** Move them into `/jannah-child/templates/` and register them properly (see next phase).

### Step 3.5 – Remove Titles / Breadcrumbs

Jannah already has options to hide titles and breadcrumbs per page/post.  
**Action:** Delete the “Remove Titles” snippet. Use Jannah’s **Page Settings** meta box to hide title where needed.

### Step 3.6 – Custom Buttons, Boxes, Columns

Replace with Jannah shortcodes. Example:

- `[button size="medium" link="..."]Click[/button]`
- `[box type="info"]Content[/box]`
- `[columns] [column]Content[/column] [/columns]`

You can embed these in your `.tez-*` layouts via the Page Builder’s Custom Content Blocks.

### Step 3.7 – Reading Progress

Jannah includes a reading progress bar option (check **Theme Options → Post Settings**). Enable it there.

### Step 3.8 – Back to Top

Jannah has a built‑in back‑to‑top button (enable in **Theme Options → Layout Settings**). Remove custom one.

### Step 3.9 – FAQ Accordion

Jannah’s `[toggle]` shortcode provides accordion functionality. Replace your custom FAQ HTML with:

```
[toggle title="Question 1"]Answer 1[/toggle]
[toggle title="Question 2"]Answer 2[/toggle]
```

### Step 3.10 – Font Awesome

Your custom snippets load FA twice. Jannah already includes FA via the theme.  
**Action:** Remove all FA enqueues from your code. Jannah will handle it. If you need a newer version, use a child theme filter to update FA, but not needed.

---

## Phase 4: Migrate Custom Page Templates (Day 4)

Your custom page templates (About, Contact, Tag Hub, Sitemap, 404) are currently in WP Code or as standalone files. Move them into the child theme following Jannah’s conventions.

### Step 4.1 – Page Templates (About, Contact, Tag Hub)

Create files in `/jannah-child/templates/`:

- `template-about.php`
- `template-contact.php`
- `template-tag-hub.php`

Add the standard WordPress template header:

```php
<?php
/*
Template Name: About Teznevisan
*/
```

Then copy the PHP from your snippets into these files. Ensure they call `get_header()` and `get_footer()`.

### Step 4.2 – Register the Templates

In `functions.php`, add a filter to make Jannah aware of these templates:

```php
add_filter( 'theme_page_templates', 'tez_add_custom_templates' );
function tez_add_custom_templates( $templates ) {
    $templates[ get_stylesheet_directory() . '/templates/template-about.php' ] = 'About Teznevisan';
    $templates[ get_stylesheet_directory() . '/templates/template-contact.php' ] = 'Contact Teznevisan';
    $templates[ get_stylesheet_directory() . '/templates/template-tag-hub.php' ] = 'Tag Hub';
    return $templates;
}
```

### Step 4.3 – 404 Hub

Override the 404 template by creating `404.php` in the child theme root. Copy your custom 404 hub code there. Call `get_header()` and `get_footer()`.

### Step 4.4 – Visual Sitemap

If your sitemap is a page template, add it like above. If it’s a content filter (like `the_content`), keep it in `inc/visual-sitemap.php` as it already hooks into `the_content`.

---

## Phase 5: Service Pages – Rebuild Using Jannah Page Builder (Day 5-6)

Your current service pages are fully custom‑rendered in PHP, bypassing the theme. This is the biggest performance and maintainability problem.

We’ll rebuild each service page using **Jannah Page Builder** + **Custom Content Blocks** + your `.tez-*` CSS.

### Step 5.1 – Create New Service Pages (as Drafts)

1. Go to **Pages → Add New**.
2. Give it a title, e.g., “انجام پایان نامه”.
3. Select **Template: Full‑width** (or any Jannah template).
4. Open the **TieLabs Page Builder**.
5. Add a **Custom Content Block** and paste the HTML structure with your `.tez-*` classes.
6. Inside that HTML, use Jannah shortcodes for buttons, lists, etc.
7. Add sections for hero, features, process, pricing, FAQ (using `[toggle]`), and a call‑to‑action.
8. Save as draft – do not publish yet.

### Step 5.2 – Embed Custom Forms

For your inquiry form, use the existing `service-form-handler.php` module. In the page, add the shortcode `[tezinquiry]` (or whatever your form shortcode is). The module will handle the AJAX and display.

### Step 5.3 – Replace Old Service Pages

Once all new service pages are ready, **delete the old ones** (or redirect them) and publish the new ones. This eliminates the heavy PHP‑generated pages.

---

## Phase 6: Single Post Cleanup (Day 6)

Your single post layout is also overridden. Use Jannah’s native single post layouts.

1. Go to **Jannah → Theme Options → Post Settings**.
2. Choose a layout (e.g., **Standard** or **Full‑width**).
3. Enable/disable elements like author box, related posts, etc., via options.
4. For per‑post overrides, use the meta box in each post editor.
5. **Remove** any custom single‑post PHP from WP Code.

If you need a custom TOC on single posts, your `beautiful-toc.php` will auto‑insert it (or use the `[teztoc]` shortcode).

---

## Phase 7: Performance Lockdown (Day 7)

Now that the site is using Jannah’s native structure + a few custom modules, we can aggressively optimize.

### Step 7.1 – Use a Caching Plugin (WP Rocket)

- Enable **page caching**.
- Enable **minify CSS/JS**.
- Enable **combine CSS/JS**.
- Enable **delay JS** (set to “delay until user interaction”).
- Enable **lazy load** for images.
- Generate **Critical CSS** (WP Rocket can do this automatically).

### Step 7.2 – Image Optimization

- Install **ShortPixel** or **Imagify**.
- Convert all images to WebP.
- Serve scaled images.

### Step 7.3 – Database Optimization

- Install **WP‑Optimize**.
- Clean post revisions, spam, transients.
- Schedule weekly cleanup.

### Step 7.4 – Test & Tweak

Run **Google PageSpeed Insights** and **GTmetrix** on key pages (home, service, blog). Fix any remaining render‑blocking resources by deferring non‑critical JS.

---

## Phase 8: Final Quality Assurance (Day 8-10)

### Step 8.1 – Console Errors

Open browser dev tools and check for JavaScript errors. Fix any that arise (likely from old inline scripts – remove them).

### Step 8.2 – Duplicate H1s

Inspect each page – ensure only one H1 exists. Jannah outputs the post title as H1; your custom content should use H2/H3.

### Step 8.3 – Schema Validation

Use Google’s **Rich Results Test** on sample pages. Remove any overlapping schemas (you may have to disable RankMath’s schema on certain pages if your custom module injects its own). Ideally, let RankMath handle schema, and disable your custom schema code.

### Step 8.4 – Mobile Responsiveness

Test on actual mobile devices or Chrome’s device toolbar. Ensure the `.tez-*` grids collapse properly. Adjust CSS if needed.

### Step 8.5 – Dark Mode / Sepia

Toggle the `data-theme` attribute on `<html>` and verify colors change correctly. If not, your CSS may need adjustment (use CSS variables).

---

## Phase 9: Launch & Monitoring (Day 11+)

1. **Deploy to live** after thorough staging testing.
2. **Clear all caches** (server, Cloudflare, WP Rocket).
3. **Submit sitemap** to Google Search Console.
4. **Request indexing** for the new service pages.
5. **Monitor** in GSC for crawl errors and index status.
6. **Track rankings** for target keywords.

---

## Completed Tasks (from Excel)

We have already marked many tasks as completed in your Excel file. The remaining tasks are now integrated into this roadmap. Here is a summary of what’s done vs. what’s next:

| Category               | Completed Tasks (✓)                                      | Remaining (in this roadmap)                              |
|------------------------|-----------------------------------------------------------|----------------------------------------------------------|
| Security               | Passwords changed, Wordfence, 2FA, Cloudflare             | –                                                        |
| Spam cleanup           | 410 rules, robots.txt, disavow, GSC removals              | –                                                        |
| Technical SEO          | .htaccess, redirects, sitemap submission                  | Fix canonical issues, remove noindex from key pages      |
| Performance            | –                                                         | **Entire Phase 7** (caching, minify, images)             |
| Theme migration        | –                                                         | **Phases 1-6** (child theme setup, replace features)     |
| UI/UX                  | –                                                         | Rebuild service pages, fix responsive, dark mode         |
| Content                | Some posts have images, excerpts pending                  | Add alt texts, meta descriptions, expand thin content    |
| Backlinks              | Disavow done                                              | Build new quality links (Phase 4 of original plan)       |

---

## Checklist for Immediate Action

Use this checklist to track progress through the phases. Copy it to your preferred project management tool.

```markdown
## Phase 0: Prep
- [ ] Full backup (already done, verify)
- [ ] Staging environment ready
- [ ] All WP Code snippets deactivated on staging
- [ ] Jannah Child Theme active on staging
- [ ] Jannah Extensions plugin active

## Phase 1: Child Theme Foundation
- [ ] Create /inc/ folder in child theme
- [ ] Move all custom PHP modules into /inc/
- [ ] Update functions.php to load modules and enqueue styles
- [ ] Test that site loads (expect broken styles, but PHP modules working)

## Phase 2: Consolidate CSS
- [ ] Merge all CSS snippets into /assets/css/tez-custom.css
- [ ] Remove !important and unused classes
- [ ] Enqueue tez-custom.css after parent styles
- [ ] Set Jannah primary color to #2563eb

## Phase 3: Replace Redundant Features
- [ ] Delete Star Rating snippet (use Jannah [review])
- [ ] Delete Remove Titles snippet (use Jannah meta box)
- [ ] Delete custom buttons/boxes – use Jannah shortcodes
- [ ] Delete custom FAQ – use [toggle]
- [ ] Delete custom reading progress – enable Jannah option
- [ ] Delete custom back-to-top – enable Jannah option
- [ ] Remove duplicate Font Awesome enqueues
- [ ] Keep advanced ToC, poll, sitemap, tag hub, 404 hub in child theme

## Phase 4: Migrate Page Templates
- [ ] Move about, contact, tag hub templates to /templates/
- [ ] Register them via theme_page_templates filter
- [ ] Override 404.php in child theme with your 404 hub
- [ ] Ensure all templates call get_header() / get_footer()

## Phase 5: Rebuild Service Pages
- [ ] Create draft service pages using Page Builder + Custom Content Blocks
- [ ] Embed custom form shortcode where needed
- [ ] Replace old service pages after verifying new ones

## Phase 6: Single Post Cleanup
- [ ] Set default single post layout in Jannah options
- [ ] Remove any custom single.php overrides
- [ ] Test ToC auto-insert on long posts

## Phase 7: Performance
- [ ] Install WP Rocket (or similar)
- [ ] Enable page cache, minify, combine CSS/JS, delay JS
- [ ] Generate Critical CSS
- [ ] Install image optimization plugin and convert to WebP
- [ ] Install database optimizer and clean up
- [ ] Run PageSpeed Insights – aim for 100/100

## Phase 8: QA
- [ ] Check for console errors on all page types
- [ ] Verify only one H1 per page
- [ ] Test schema with Rich Results Test – fix conflicts
- [ ] Test mobile responsiveness across devices
- [ ] Test dark/sepia mode toggles

## Phase 9: Launch
- [ ] Deploy to live
- [ ] Clear all caches
- [ ] Submit sitemap to GSC
- [ ] Request indexing for new pages
- [ ] Monitor GSC daily for first week
```

---

## Expected Timeline & Results

| Phase                      | Duration   | Outcome                                                      |
|----------------------------|------------|--------------------------------------------------------------|
| Phase 0-2 (Foundation)     | 2 days     | Child theme ready, CSS consolidated, site loadable           |
| Phase 3-4 (Replacements)   | 3 days     | All redundant features gone, custom templates migrated       |
| Phase 5 (Service Pages)    | 2 days     | New lightweight service pages built                           |
| Phase 6-7 (Performance)    | 2 days     | PageSpeed >90, CWV improving                                 |
| Phase 8 (QA)               | 1 day      | Zero errors, fully responsive                                 |
| **Total**                  | **10 days**| Site transformed – ready for growth                          |

After launch, you will have a **clean, fast, maintainable** site that ranks well and provides excellent user experience.

---

## Conclusion

By following this roadmap, you will:

- Eliminate all technical debt accumulated from WP Code snippets.
- Harness the full power of Jannah’s built‑in features, reducing custom code by 80%.
- Achieve perfect PageSpeed and Core Web Vitals.
- Create a consistent, professional UI that works in light, dark, and sepia modes.
- Set a solid foundation for future SEO and content marketing.

Your site is already on the path to recovery; this theme migration is the final, most critical step. Execute it methodically, test thoroughly on staging, and you’ll have a website that not only recovers its rankings but exceeds its previous performance.

If you encounter any roadblocks while implementing any phase, feel free to ask for clarification – I’m here to help you every step of the way.
